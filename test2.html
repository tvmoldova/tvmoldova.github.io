<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Video.js с защищённым HLS</title>
  <link href="https://cdn.jsdelivr.net/npm/video.js@7.21.1/dist/video-js.min.css" rel="stylesheet">
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background: #1a1a1a;
      font-family: Arial, sans-serif;
    }
    .player-container {
      width: 90%;
      max-width: 900px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      border-radius: 10px;
      overflow: hidden;
    }
    .info {
      color: white;
      text-align: center;
      padding: 15px;
      background: #2a2a2a;
    }
  </style>
</head>
<body>
  <div class="player-container">
    <video
      id="hls-video"
      class="video-js vjs-default-skin vjs-big-play-centered"
      controls
      preload="auto"
      width="100%"
      height="450"
      poster="https://placehold.co/800x450/2a2a2a/FFF?text=HLS+Stream"
      data-setup='{}'>
      <p class="vjs-no-js">
        Для просмотра видео включите JavaScript
      </p>
    </video>
    <div class="info">
      <p>Используется проксирование для обхода ограничений</p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/video.js@7.21.1/dist/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-http-streaming@2.15.0/dist/videojs-http-streaming.min.js"></script>
  
  <script>
    // Альтернативные прокси-серверы
    const proxies = [
      "https://corsproxy.io/?",
      "https://api.allorigins.win/raw?url=",
      "https://cors.convertro.com/",
      "https://proxy.cors.sh/"
    ];

    // Основная функция инициализации
    async function initPlayer() {
      const player = videojs('hls-video');
      const streamUrl = "http://a3fc2fc5.rossteleccom.net/iptv/8T2MH6W8ZDP8PZXZ4RMX7P6Q/9314/index.m3u8";
      
      try {
        // Попробуем разные прокси последовательно
        for (const proxy of proxies) {
          const proxyUrl = proxy + encodeURIComponent(streamUrl);
          console.log("Пробуем прокси:", proxyUrl);
          
          // Тестируем прокси перед использованием
          const test = await fetch(proxyUrl, { method: 'HEAD' });
          
          if (test.ok) {
            player.src({
              src: proxyUrl,
              type: 'application/x-mpegURL',
              withCredentials: false
            });
            
            player.ready(() => {
              player.play().catch(e => {
                console.log("Автовоспроизведение не удалось:", e.message);
              });
            });
            
            console.log("Используется прокси:", proxy);
            return;
          }
        }
        
        throw new Error("Все прокси недоступны");
        
      } catch (error) {
        console.error("Ошибка инициализации:", error);
        player.error({
          code: 4,
          message: `Ошибка загрузки: ${error.message || "проверьте консоль"}`
        });
      }
    }

    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', initPlayer);
  </script>
</body>
</html>