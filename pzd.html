<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Ontivi Player</title>
    <link href="https://unpkg.com/video.js@7/dist/video-js.min.css" rel="stylesheet">
    <script src="https://unpkg.com/video.js@7/dist/video.min.js"></script>
    <style>
        body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
        video { width: 95vw; height: auto; margin-top: 20px; }
        select { padding: 10px; margin-top: 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>üì∫ –û–Ω–ª–∞–π–Ω –¢–í</h1>
    <select id="channelSelect">
        <option value="muzhskoe-kinotv.html">–ú—É–∂—Å–∫–æ–µ –ö–∏–Ω–æ</option>
        <option value="kinomix.html">–ö–∏–Ω–æ–º–∏–∫—Å</option>
        <option value="tv1000.html">TV1000</option>
    </select>

    <video id="player" class="video-js vjs-default-skin" controls autoplay></video>

    <script>
        const player = videojs('player');
        const select = document.getElementById('channelSelect');

        select.addEventListener('change', async () => {
            const channel = select.value;
            const url = `https://corsproxy.io/?https://ip.ontivi.net/${channel}`;
            const secret = 'ef84ecb5d1';

            try {
                const res = await fetch(url);
                const html = await res.text();

                // –í—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ RegExp
                const kodk = html.match(/var kodk="([^"]+)"/)?.[1];
                const kos = html.match(/var kos="([^"]+)"/)?.[1];
                const file = html.match(/file:"([^"]+)"/)?.[1];

                if (!kodk || !kos || !file) {
                    alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ");
                    return;
                }

                const nonce = Math.floor(100 + Math.random() * 900); // 3 —Ü–∏—Ñ—Ä—ã
                const hashInput = kodk + nonce + kos + secret;
                const hash = md5(hashInput);
                const k = `${kodk}${nonce}${kos}${hash}`;
                const m3u8 = `https://s.ontivi.net/${file}/index.m3u8?k=${k}`;

                console.log("‚ñ∂Ô∏è", m3u8);
                player.src({ type: 'application/x-mpegURL', src: m3u8 });
                player.play();
            } catch (e) {
                alert("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + e.message);
            }
        });

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É
        select.dispatchEvent(new Event('change'));
    </script>

    <!-- MD5 –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
</body>
</html>